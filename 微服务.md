# 微服务

## 单体架构的缺点

1. 复杂性逐渐变高。比如有的项目有几十万行代码，各个模块之间区别比较模糊，逻辑比较混乱，代码越多复杂性越高，越难解决遇到的问题。

2. 技术债务逐渐上升。公司的人员流动是再正常不过的事情，有的员工在离职之前，疏于代码质量的自我管束，导致留下来很多坑，由于单体项目代码量庞大的惊人，留下的坑很难被发觉，这就给新来的员工带来很大的烦恼，人员流动越大所留下的坑越多，也就是所谓的技术债务越来越多。

3. 部署速度逐渐变慢。这个就很好理解了，单体架构模块非常多，代码量非常庞大，导致部署项目所花费的时间越来越多，曾经有的项目启动就要一二十分钟，这是多么恐怖的事情啊，启动几次项目一天的时间就过去了，留给开发者开发的时间就非常少了。

4. 阻碍技术创新。比如以前的某个项目使用struts2写的，由于各个模块之间有着千丝万缕的联系，代码量大，逻辑不够清楚，如果现在想用spring mvc来重构这个项目将是非常困难的，付出的成本将非常大，所以更多的时候公司不得不硬着头皮继续使用老的struts架构，这就阻碍了技术的创新。

5. 无法按需伸缩。比如说电影模块是CPU密集型的模块，而订单模块是IO密集型的模块，假如我们要提升订单模块的性能，比如加大内存、增加硬盘，但是由于所有的模块都在一个架构下，因此我们在扩展订单模块的性能时不得不考虑其它模块的因素，因为我们不能因为扩展某个模块的性能而损害其它模块的性能，从而无法按需进行伸缩。

## 能不能做成微服务，取决于四个要素

1. 小：微服务体积小，2 pizza 团队。
1. 独：能够独立的部署和运行。
1. 轻：使用轻量级的通信机制和架构。
1. 松：为服务之间是松耦合的。

## 为什么我们的系统要拆分

1. 职责不单一。一个系统包含过多功能，每个功能也比较复杂。
2. 技术债务上升。重复代码，特殊业务逻辑贯穿全场。
3. 不同模块迭代不一样。打印模块改动少，要求稳定。
4. 阻碍技术创新和业务迭代。想改任务生成逻辑，会影响到物流部分。想接入发票打印渠道，很难改动。
5. 测试困难，测单个模块需要走全部流程。
6. 系统稳定性差，bug多，故障率高。

## 拆分后好处

1. 每个模块更简单。更容易迭代和测试。
2. 梳理和优化了业务逻辑，便于业务和技术迭代。
3. 降低开发成本，降低故障率。
4. 服务化，接入新业务。每个模块都有对外的消息推送，便于业务监控。